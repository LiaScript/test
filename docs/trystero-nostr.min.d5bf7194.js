var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire55a5;e.register("g9MJ9",(function(t,r){var n,o,a,i;n=t.exports,o="joinRoom",a=function(){return xt},Object.defineProperty(n,o,{get:a,set:i,enumerable:!0,configurable:!0});var s,c,f,l,d,u,h,y,g,p,m,w,v,b,E,x,A=e("dM3DM"),S=e("aQXMn"),P=Object.freeze({__proto__:null,default:{}});const I=BigInt(0),k=BigInt(1),B=BigInt(2),T=BigInt(3),H=BigInt(8),R=Object.freeze({a:I,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:k,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),U=(e,t)=>(e+t/B)/t,C={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(e){const{n:t}=R,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-k*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),a=r,i=BigInt("0x100000000000000000000000000000000"),s=U(a*e,t),c=U(-n*e,t);let f=oe(e-s*r-c*o,t),l=oe(-s*n-c*a,t);const d=f>i,u=l>i;if(d&&(f=t-f),u&&(l=t-l),f>i||l>i)throw Error("splitScalarEndo: Endomorphism failed, k="+e);return{k1neg:d,k1:f,k2neg:u,k2:l}}},D=32;function z(e){const{a:t,b:r}=R,n=oe(e*e),o=oe(n*e);return oe(o+t*e+r)}const O=R.a===I;class $ extends Error{constructor(e){super(e)}}function N(e){if(!(e instanceof L))throw new TypeError("JacobianPoint expected")}class L{static fromAffine(e){if(!(e instanceof j))throw new TypeError("JacobianPoint#fromAffine: expected Point");return e.equals(j.ZERO)?L.ZERO:new L(e.x,e.y,k)}static toAffineBatch(e){const t=function(e,t=R.P){const r=Array(e.length),n=ie(e.reduce(((e,n,o)=>n===I?e:(r[o]=e,oe(e*n,t))),k),t);return e.reduceRight(((e,n,o)=>n===I?e:(r[o]=oe(e*r[o],t),oe(e*n,t))),n),r}(e.map((e=>e.z)));return e.map(((e,r)=>e.toAffine(t[r])))}static normalizeZ(e){return L.toAffineBatch(e).map(L.fromAffine)}equals(e){N(e);const{x:t,y:r,z:n}=this,{x:o,y:a,z:i}=e,s=oe(n*n),c=oe(i*i),f=oe(t*c),l=oe(o*s),d=oe(oe(r*i)*c),u=oe(oe(a*n)*s);return f===l&&d===u}negate(){return new L(this.x,oe(-this.y),this.z)}double(){const{x:e,y:t,z:r}=this,n=oe(e*e),o=oe(t*t),a=oe(o*o),i=e+o,s=oe(B*(oe(i*i)-n-a)),c=oe(T*n),f=oe(c*c),l=oe(f-B*s),d=oe(c*(s-l)-H*a),u=oe(B*t*r);return new L(l,d,u)}add(e){N(e);const{x:t,y:r,z:n}=this,{x:o,y:a,z:i}=e;if(o===I||a===I)return this;if(t===I||r===I)return e;const s=oe(n*n),c=oe(i*i),f=oe(t*c),l=oe(o*s),d=oe(oe(r*i)*c),u=oe(oe(a*n)*s),h=oe(l-f),y=oe(u-d);if(h===I)return y===I?this.double():L.ZERO;const g=oe(h*h),p=oe(h*g),m=oe(f*g),w=oe(y*y-p-B*m),v=oe(y*(m-w)-d*p),b=oe(n*i*h);return new L(w,v,b)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){const t=L.ZERO;if("bigint"==typeof e&&e===I)return t;let r=ne(e);if(r===k)return this;if(!O){let e=t,n=this;for(;r>I;)r&k&&(e=e.add(n)),n=n.double(),r>>=k;return e}let{k1neg:n,k1:o,k2neg:a,k2:i}=C.splitScalar(r),s=t,c=t,f=this;for(;o>I||i>I;)o&k&&(s=s.add(f)),i&k&&(c=c.add(f)),f=f.double(),o>>=k,i>>=k;return n&&(s=s.negate()),a&&(c=c.negate()),c=new L(oe(c.x*C.beta),c.y,c.z),s.add(c)}precomputeWindow(e){const t=O?128/e+1:256/e+1,r=[];let n=this,o=n;for(let a=0;a<t;a++){o=n,r.push(o);for(let t=1;t<2**(e-1);t++)o=o.add(n),r.push(o);n=o.double()}return r}wNAF(e,t){!t&&this.equals(L.BASE)&&(t=j.BASE);const r=t&&t._WINDOW_SIZE||1;if(256%r)throw Error("Point#wNAF: Invalid precomputation window, must be power of 2");let n=t&&Z.get(t);n||(n=this.precomputeWindow(r),t&&1!==r&&(n=L.normalizeZ(n),Z.set(t,n)));let o=L.ZERO,a=L.BASE;const i=1+(O?128/r:256/r),s=2**(r-1),c=BigInt(2**r-1),f=2**r,l=BigInt(r);for(let t=0;t<i;t++){const r=t*s;let i=Number(e&c);e>>=l,i>s&&(i-=f,e+=k);const d=r,u=r+Math.abs(i)-1,h=t%2!=0,y=i<0;0===i?a=a.add(_(h,n[d])):o=o.add(_(y,n[u]))}return{p:o,f:a}}multiply(e,t){let r,n,o=ne(e);if(O){const{k1neg:e,k1:a,k2neg:i,k2:s}=C.splitScalar(o);let{p:c,f:f}=this.wNAF(a,t),{p:l,f:d}=this.wNAF(s,t);c=_(e,c),l=_(i,l),l=new L(oe(l.x*C.beta),l.y,l.z),r=c.add(l),n=f.add(d)}else{const{p:e,f:a}=this.wNAF(o,t);r=e,n=a}return L.normalizeZ([r,n])[0]}toAffine(e){const{x:t,y:r,z:n}=this,o=this.equals(L.ZERO);null==e&&(e=o?H:ie(n));const a=e,i=oe(a*a),s=oe(i*a),c=oe(t*i),f=oe(r*s),l=oe(n*a);if(o)return j.ZERO;if(l!==k)throw Error("invZ was invalid");return new j(c,f)}constructor(e,t,r){this.x=e,this.y=t,this.z=r}}function _(e,t){const r=t.negate();return e?r:t}L.BASE=new L(R.Gx,R.Gy,k),L.ZERO=new L(I,k,I);const Z=new WeakMap;class j{_setWindowSize(e){this._WINDOW_SIZE=e,Z.delete(this)}hasEvenY(){return this.y%B===I}static fromCompressedHex(e){const t=32===e.length,r=te(t?e:e.subarray(1));if(!le(r))throw Error("Point is not on curve");let n=function(e){const{P:t}=R,r=BigInt(6),n=BigInt(11),o=BigInt(22),a=BigInt(23),i=BigInt(44),s=BigInt(88),c=e*e*e%t,f=c*c*e%t,l=ae(f,T)*f%t,d=ae(l,T)*f%t,u=ae(d,B)*c%t,h=ae(u,n)*u%t,y=ae(h,o)*h%t,g=ae(y,i)*y%t,p=ae(g,s)*g%t,m=ae(p,i)*y%t,w=ae(m,T)*f%t,v=ae(w,a)*h%t,b=ae(v,r)*c%t,E=ae(b,B);if(E*E%t!==e)throw Error("Cannot find square root");return E}(z(r));const o=(n&k)===k;t?o&&(n=oe(-n)):!(1&~e[0])!==o&&(n=oe(-n));const a=new j(r,n);return a.assertValidity(),a}static fromUncompressedHex(e){const t=te(e.subarray(1,33)),r=te(e.subarray(33,65)),n=new j(t,r);return n.assertValidity(),n}static fromHex(e){const t=re(e),r=t.length,n=t[0];if(32===r)return this.fromCompressedHex(t);if(33===r&&(2===n||3===n))return this.fromCompressedHex(t);if(65===r&&4===n)return this.fromUncompressedHex(t);throw Error("Point.fromHex: received invalid point. Expected 32-33 compressed bytes or 65 uncompressed bytes, not "+r)}static fromPrivateKey(e){return j.BASE.multiply(de(e))}static fromSignature(e,t,r){const{r:n,s:o}=function(e){if(e instanceof K)return e.assertValidity(),e;try{return K.fromDER(e)}catch(t){return K.fromCompact(e)}}(t);if(![0,1,2,3].includes(r))throw Error("Cannot recover: invalid recovery bit");const a=function(e,t=!1){const r=function(e){const t=8*e.length-256,r=te(e);return t>0?r>>BigInt(t):r}(e);if(t)return r;const{n:n}=R;return r>=n?r-n:r}(re(e)),{n:i}=R,s=2===r||3===r?n+i:n,c=ie(s,i),f=oe(-a*c,i),l=oe(o*c,i),d=1&r?"03":"02",u=j.fromHex(d+X(s)),h=j.BASE.multiplyAndAddUnsafe(u,f,l);if(!h)throw Error("Cannot recover signature: point at infinify");return h.assertValidity(),h}toRawBytes(e=!1){return ee(this.toHex(e))}toHex(e=!1){const t=X(this.x);return e?`${this.hasEvenY()?"02":"03"}${t}`:`04${t}${X(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const e="Point is not on elliptic curve",{x:t,y:r}=this;if(!le(t)||!le(r))throw Error(e);const n=oe(r*r);if(oe(n-z(t))!==I)throw Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new j(this.x,oe(-this.y))}double(){return L.fromAffine(this).double().toAffine()}add(e){return L.fromAffine(this).add(L.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return L.fromAffine(this).multiply(e,this).toAffine()}multiplyAndAddUnsafe(e,t,r){const n=L.fromAffine(this),o=t===I||t===k||this!==j.BASE?n.multiplyUnsafe(t):n.multiply(t),a=L.fromAffine(e).multiplyUnsafe(r),i=o.add(a);return i.equals(L.ZERO)?void 0:i.toAffine()}constructor(e,t){this.x=e,this.y=t}}function M(e){return Number.parseInt(e[0],16)>=8?"00"+e:e}function V(e){if(e.length<2||2!==e[0])throw Error("Invalid signature integer tag: "+J(e));const t=e[1],r=e.subarray(2,t+2);if(!t||r.length!==t)throw Error("Invalid signature integer: wrong length");if(0===r[0]&&r[1]<=127)throw Error("Invalid signature integer: trailing length");return{data:te(r),left:e.subarray(t+2)}}j.BASE=new j(R.Gx,R.Gy),j.ZERO=new j(I,I);class K{static fromCompact(e){const t=e instanceof Uint8Array,r="Signature.fromCompact";if("string"!=typeof e&&!t)throw new TypeError(r+": Expected string or Uint8Array");const n=t?J(e):e;if(128!==n.length)throw Error(r+": Expected 64-byte hex");return new K(Q(n.slice(0,64)),Q(n.slice(64,128)))}static fromDER(e){const t=e instanceof Uint8Array;if("string"!=typeof e&&!t)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r:r,s:n}=function(e){if(e.length<2||48!=e[0])throw Error("Invalid signature tag: "+J(e));if(e[1]!==e.length-2)throw Error("Invalid signature: incorrect length");const{data:t,left:r}=V(e.subarray(2)),{data:n,left:o}=V(r);if(o.length)throw Error("Invalid signature: left bytes after parsing: "+J(o));return{r:t,s:n}}(t?e:ee(e));return new K(r,n)}static fromHex(e){return this.fromDER(e)}assertValidity(){const{r:e,s:t}=this;if(!fe(e))throw Error("Invalid Signature: r must be 0 < r < n");if(!fe(t))throw Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const e=R.n>>k;return this.s>e}normalizeS(){return this.hasHighS()?new K(this.r,oe(-this.s,R.n)):this}toDERRawBytes(){return ee(this.toDERHex())}toDERHex(){const e=M(Y(this.s)),t=M(Y(this.r)),r=e.length/2,n=t.length/2,o=Y(r),a=Y(n);return`30${Y(n+r+4)}02${a}${t}02${o}${e}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return ee(this.toCompactHex())}toCompactHex(){return X(this.r)+X(this.s)}constructor(e,t){this.r=e,this.s=t,this.assertValidity()}}function q(...e){if(!e.every((e=>e instanceof Uint8Array)))throw Error("Uint8Array list expected");if(1===e.length)return e[0];const t=e.reduce(((e,t)=>e+t.length),0),r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const o=e[t];r.set(o,n),n+=o.length}return r}const W=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function J(e){if(!(e instanceof Uint8Array))throw Error("Expected Uint8Array");let t="";for(let r=0;r<e.length;r++)t+=W[e[r]];return t}const G=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function X(e){if("bigint"!=typeof e)throw Error("Expected bigint");if(!(I<=e&&e<G))throw Error("Expected number 0 <= n < 2^256");return e.toString(16).padStart(64,"0")}function F(e){const t=ee(X(e));if(32!==t.length)throw Error("Error: expected 32 bytes");return t}function Y(e){const t=e.toString(16);return 1&t.length?"0"+t:t}function Q(e){if("string"!=typeof e)throw new TypeError("hexToNumber: expected string, got "+typeof e);return BigInt("0x"+e)}function ee(e){if("string"!=typeof e)throw new TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw Error("hexToBytes: received invalid unpadded hex"+e.length);const t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){const n=2*r,o=e.slice(n,n+2),a=Number.parseInt(o,16);if(Number.isNaN(a)||a<0)throw Error("Invalid byte sequence");t[r]=a}return t}function te(e){return Q(J(e))}function re(e){return e instanceof Uint8Array?Uint8Array.from(e):ee(e)}function ne(e){if("number"==typeof e&&Number.isSafeInteger(e)&&e>0)return BigInt(e);if("bigint"==typeof e&&fe(e))return e;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function oe(e,t=R.P){const r=e%t;return r>=I?r:t+r}function ae(e,t){const{P:r}=R;let n=e;for(;t-- >I;)n*=n,n%=r;return n}function ie(e,t=R.P){if(e===I||t<=I)throw Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=oe(e,t),n=t,o=I,a=k;for(;r!==I;){const e=n%r,t=o-a*(n/r);n=r,r=e,o=a,a=t}if(n!==k)throw Error("invert: does not exist");return oe(o,t)}let se,ce;function fe(e){return I<e&&e<R.n}function le(e){return I<e&&e<R.P}function de(e){let t;if("bigint"==typeof e)t=e;else if("number"==typeof e&&Number.isSafeInteger(e)&&e>0)t=BigInt(e);else if("string"==typeof e){if(64!==e.length)throw Error("Expected 32 bytes of private key");t=Q(e)}else{if(!(e instanceof Uint8Array))throw new TypeError("Expected valid private key");if(e.length!==D)throw Error("Expected 32 bytes of private key");t=te(e)}if(!fe(t))throw Error("Expected private key: 0 < key < n");return t}function ue(e){return e instanceof j?(e.assertValidity(),e):j.fromHex(e)}function he(e){return oe(te(e),R.n)}class ye{static fromHex(e){const t=re(e);if(64!==t.length)throw new TypeError("SchnorrSignature.fromHex: expected 64 bytes, not "+t.length);const r=te(t.subarray(0,32)),n=te(t.subarray(32,64));return new ye(r,n)}assertValidity(){const{r:e,s:t}=this;if(!le(e)||!fe(t))throw Error("Invalid signature")}toHex(){return X(this.r)+X(this.s)}toRawBytes(){return ee(this.toHex())}constructor(e,t){this.r=e,this.s=t,this.assertValidity()}}class ge{getScalar(e){const t=j.fromPrivateKey(e),r=t.hasEvenY()?e:R.n-e;return{point:t,scalar:r,x:t.toRawX()}}initNonce(e,t){return F(e^te(t))}finalizeNonce(e){const t=oe(te(e),R.n);if(t===I)throw Error("sign: Creation of signature failed. k is zero");const{point:r,x:n,scalar:o}=this.getScalar(t);return{R:r,rx:n,k:o}}finalizeSig(e,t,r,n){return new ye(e.x,oe(t+r*n,R.n)).toRawBytes()}error(){throw Error("sign: Invalid signature produced")}async calc(){const{m:e,d:t,px:r,rand:n}=this,o=Se.taggedHash,a=this.initNonce(t,await o(xe.aux,n)),{R:i,rx:s,k:c}=this.finalizeNonce(await o(xe.nonce,a,r,e)),f=he(await o(xe.challenge,s,r,e)),l=this.finalizeSig(i,c,f,t);return await we(l,e,r)||this.error(),l}calcSync(){const{m:e,d:t,px:r,rand:n}=this,o=Se.taggedHashSync,a=this.initNonce(t,o(xe.aux,n)),{R:i,rx:s,k:c}=this.finalizeNonce(o(xe.nonce,a,r,e)),f=he(o(xe.challenge,s,r,e)),l=this.finalizeSig(i,c,f,t);return ve(l,e,r)||this.error(),l}constructor(e,t,r=Se.randomBytes()){if(null==e)throw new TypeError(`sign: Expected valid message, not "${e}"`);this.m=re(e);const{x:n,scalar:o}=this.getScalar(de(t));if(this.px=n,this.d=o,this.rand=re(r),32!==this.rand.length)throw new TypeError("sign: Expected 32 bytes of aux randomness")}}function pe(e,t,r){const n=e instanceof ye,o=n?e:ye.fromHex(e);return n&&o.assertValidity(),(0,S.default)((0,A.default)({},o),{m:re(t),P:ue(r)})}function me(e,t,r,n){const o=j.BASE.multiplyAndAddUnsafe(t,de(r),oe(-n,R.n));return!(!o||!o.hasEvenY()||o.x!==e)}async function we(e,t,r){try{const{r:n,s:o,m:a,P:i}=pe(e,t,r),s=he(await Se.taggedHash(xe.challenge,F(n),i.toRawX(),a));return me(n,i,o,s)}catch(e){return!1}}function ve(e,t,r){try{const{r:n,s:o,m:a,P:i}=pe(e,t,r),s=he(Se.taggedHashSync(xe.challenge,F(n),i.toRawX(),a));return me(n,i,o,s)}catch(e){if(e instanceof $)throw e;return!1}}const be={Signature:ye,getPublicKey:e=>j.fromPrivateKey(e).toRawX(),sign:async(e,t,r)=>new ge(e,t,r).calc(),verify:we,signSync:(e,t,r)=>new ge(e,t,r).calcSync(),verifySync:ve};j.BASE._setWindowSize(8);const Ee={node:P,web:"object"==typeof self&&"crypto"in self?self.crypto:void 0},xe={challenge:"BIP0340/challenge",aux:"BIP0340/aux",nonce:"BIP0340/nonce"},Ae={},Se={bytesToHex:J,hexToBytes:ee,concatBytes:q,mod:oe,invert:ie,isValidPrivateKey(e){try{return de(e),!0}catch(e){return!1}},_bigintTo32Bytes:F,_normalizePrivateKey:de,hashToPrivateKey(e){if((e=re(e)).length<40||e.length>1024)throw Error("Expected valid bytes of private key as per FIPS 186");return F(oe(te(e),R.n-k)+k)},randomBytes(e=32){if(Ee.web)return Ee.web.getRandomValues(new Uint8Array(e));if(Ee.node){const{randomBytes:t}=Ee.node;return Uint8Array.from(t(e))}throw Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>Se.hashToPrivateKey(Se.randomBytes(40)),precompute(e=8,t=j.BASE){const r=t===j.BASE?t:new j(t.x,t.y);return r._setWindowSize(e),r.multiply(T),r},async sha256(...e){if(Ee.web){const t=await Ee.web.subtle.digest("SHA-256",q(...e));return new Uint8Array(t)}if(Ee.node){const{createHash:t}=Ee.node,r=t("sha256");return e.forEach((e=>r.update(e))),Uint8Array.from(r.digest())}throw Error("The environment doesn't have sha256 function")},async hmacSha256(e,...t){if(Ee.web){const r=await Ee.web.subtle.importKey("raw",e,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),n=q(...t),o=await Ee.web.subtle.sign("HMAC",r,n);return new Uint8Array(o)}if(Ee.node){const{createHmac:r}=Ee.node,n=r("sha256",e);return t.forEach((e=>n.update(e))),Uint8Array.from(n.digest())}throw Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,async taggedHash(e,...t){let r=Ae[e];if(void 0===r){const t=await Se.sha256(Uint8Array.from(e,(e=>e.charCodeAt(0))));r=q(t,t),Ae[e]=r}return Se.sha256(r,...t)},taggedHashSync(e,...t){if("function"!=typeof se)throw new $("sha256Sync is undefined, you need to set it");let r=Ae[e];if(void 0===r){const t=se(Uint8Array.from(e,(e=>e.charCodeAt(0))));r=q(t,t),Ae[e]=r}return se(r,...t)},_JacobianPoint:L};Object.defineProperties(Se,{sha256Sync:{configurable:!1,get:()=>se,set(e){se||(se=e)}},hmacSha256Sync:{configurable:!1,get:()=>ce,set(e){ce||(ce=e)}}});const{floor:Pe,random:Ie,sin:ke}=Math,Be="Trystero",Te=(e,t)=>Array(e).fill().map(t),He=e=>Te(e,(()=>"0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"[Pe(62*Ie())])).join(""),Re=He(20),Ue=Promise.all.bind(Promise),Ce="undefined"!=typeof window,{entries:De,fromEntries:ze,keys:Oe}=Object,$e=()=>{},Ne=e=>Error(`${Be}: ${e}`),Le=new TextEncoder,_e=new TextDecoder,Ze=e=>Le.encode(e),je=e=>_e.decode(e),Me=e=>e.reduce(((e,t)=>e+t.toString(16).padStart(2,"0")),""),Ve=(...e)=>e.join("@"),Ke=JSON.stringify,qe=JSON.parse,We=(e,t=Number.MAX_SAFE_INTEGER)=>e.split("").reduce(((e,t)=>e+t.charCodeAt(0)),0)%t,Je={},Ge="AES-GCM",Xe={},Fe=async e=>Xe[e]||(Xe[e]=Array.from(new Uint8Array(await crypto.subtle.digest("SHA-1",Ze(e)))).map((e=>e.toString(36))).join("")),Ye=async(e,t)=>{const r=crypto.getRandomValues(new Uint8Array(16));var n;return r.join(",")+"$"+(n=await crypto.subtle.encrypt({name:Ge,iv:r},await e,Ze(t)),btoa(String.fromCharCode.apply(null,new Uint8Array(n))))},Qe=async(e,t)=>{const[r,n]=t.split("$");return je(await crypto.subtle.decrypt({name:Ge,iv:new Uint8Array(r.split(","))},await e,(e=>{const t=atob(e);return new Uint8Array(t.length).map(((e,r)=>t.charCodeAt(r))).buffer})(n)))},et="icegatheringstatechange",tt="offer";var rt=(e,{rtcConfig:t,rtcPolyfill:r,turnConfig:n})=>{const o=new(r||RTCPeerConnection)((0,A.default)({iceServers:nt.concat(n||[])},t)),a={};let i=!1,s=!1,c=null;const f=e=>{e.binaryType="arraybuffer",e.bufferedAmountLowThreshold=65535,e.onmessage=e=>{var t;return null===(t=a.data)||void 0===t?void 0:t.call(a,e.data)},e.onopen=()=>{var e;return null===(e=a.connect)||void 0===e?void 0:e.call(a)},e.onclose=()=>{var e;return null===(e=a.close)||void 0===e?void 0:e.call(a)},e.onerror=e=>{var t;return null===(t=a.error)||void 0===t?void 0:t.call(a,e)}},l=e=>Promise.race([new Promise((t=>{const r=()=>{"complete"===e.iceGatheringState&&(e.removeEventListener(et,r),t())};e.addEventListener(et,r),r()})),new Promise((e=>setTimeout(e,5e3)))]).then((()=>({type:e.localDescription.type,sdp:e.localDescription.sdp.replace(/a=ice-options:trickle\s\n/g,"")})));return e?(c=o.createDataChannel("data"),f(c)):o.ondatachannel=({channel:e})=>{c=e,f(e)},o.onnegotiationneeded=async()=>{try{var e;i=!0,await o.setLocalDescription();const t=await l(o);null===(e=a.signal)||void 0===e||e.call(a,t)}catch(e){var t;null===(t=a.error)||void 0===t||t.call(a,e)}finally{i=!1}},o.onconnectionstatechange=()=>{var e;["disconnected","failed","closed"].includes(o.connectionState)&&(null===(e=a.close)||void 0===e||e.call(a))},o.ontrack=e=>{var t,r;null===(t=a.track)||void 0===t||t.call(a,e.track,e.streams[0]),null===(r=a.stream)||void 0===r||r.call(a,e.streams[0])},o.onremovestream=e=>{var t;return null===(t=a.stream)||void 0===t?void 0:t.call(a,e.stream)},e&&(o.canTrickleIceCandidates||o.onnegotiationneeded()),{created:Date.now(),connection:o,get channel(){return c},get isDead(){return"closed"===o.connectionState},async signal(t){var r;if("open"!==(null==c?void 0:c.readyState)||(null===(r=t.sdp)||void 0===r?void 0:r.includes("a=rtpmap")))try{if(t.type===tt){var n;if(i||"stable"!==o.signalingState&&!s){if(e)return;await Ue([o.setLocalDescription({type:"rollback"}),o.setRemoteDescription(t)])}else await o.setRemoteDescription(t);await o.setLocalDescription();const r=await l(o);return null===(n=a.signal)||void 0===n||n.call(a,r),r}if("answer"===t.type){s=!0;try{await o.setRemoteDescription(t)}finally{s=!1}}}catch(e){var f;null===(f=a.error)||void 0===f||f.call(a,e)}},sendData:e=>c.send(e),destroy(){null==c||c.close(),o.close(),i=!1,s=!1},setHandlers:e=>Object.assign(a,e),offerPromise:e?new Promise((e=>a.signal=t=>{t.type===tt&&e(t)})):Promise.resolve(),addStream:e=>e.getTracks().forEach((t=>o.addTrack(t,e))),removeStream:e=>o.getSenders().filter((t=>e.getTracks().includes(t.track))).forEach((e=>o.removeTrack(e))),addTrack:(e,t)=>o.addTrack(e,t),removeTrack(e){const t=o.getSenders().find((t=>t.track===e));t&&o.removeTrack(t)},replaceTrack(e,t){const r=o.getSenders().find((t=>t.track===e));if(r)return r.replaceTrack(t)}}};const nt=[...Te(3,((e,t)=>`stun:stun${t||""}.l.google.com:19302`)),"stun:stun.cloudflare.com:3478"].map((e=>({urls:e}))),ot=Object.getPrototypeOf(Uint8Array),at=16369,it=255,st="bufferedamountlow",ct=e=>"@_"+e;var ft;const lt={},dt="EVENT",ut=Se.randomPrivateKey(),ht=Me(be.getPublicKey(ut)),yt={},gt={},pt={},mt=()=>Math.floor(Date.now()/1e3),wt=e=>null!==(ft=(s=pt)[c=e])&&void 0!==ft?ft:s[c]=We(e,1e4)+2e4,vt=async(e,t)=>{const r={kind:wt(e),content:t,pubkey:ht,created_at:mt(),tags:[["x",e]]},n=Me(new Uint8Array(await crypto.subtle.digest("SHA-256",Ze(Ke([0,r.pubkey,r.created_at,r.kind,r.tags,r.content])))));return Ke([dt,(0,S.default)((0,A.default)({},r),{id:n,sig:Me(await be.sign(n,ut))})])},bt=(e,t)=>(yt[e]=t,Ke(["REQ",e,{kinds:[wt(t)],since:mt(),"#x":[t]}])),Et=e=>(delete yt[e],Ke(["CLOSE",e])),xt=(({init:e,subscribe:t,announce:r})=>{const n={};let o,a,i,s=!1;return(c,E,x)=>{var P;const{appId:I}=c;if(null===(P=n[I])||void 0===P?void 0:P[E])return n[I][E];const k={},B={},T=Ve(Be,I,E),H=Fe(T),R=Fe(Ve(T,Re)),U=(async(e,t,r)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},Ze(`${e}:${t}:${r}`)),{name:Ge},!1,["encrypt","decrypt"]))(c.password||"",I,E),C=e=>async t=>({type:t.type,sdp:await e(U,t.sdp)}),D=C(Qe),z=C(Ye),O=()=>rt(!0,c),$=(e,t,r)=>{var n;B[t]?B[t]!==e&&e.destroy():(B[t]=e,V(e,t),null===(n=k[t])||void 0===n||n.forEach(((e,t)=>{t!==r&&e.destroy()})),delete k[t])},N=(e,t)=>{B[t]===e&&delete B[t]},L=e=>(a.push(...Te(e,O)),Ue(a.splice(0,e).map((e=>e.offerPromise.then(z).then((t=>({peer:e,offer:t}))))))),_=(e,t)=>null==x?void 0:x({error:`incorrect password (${c.password}) when decrypting ${t}`,appId:I,peerId:e,roomId:E});if(!c)throw Ne("requires a config map as the first argument");if(!I&&!c.firebaseApp)throw Ne("config map is missing appId field");if(!E)throw Ne("roomId argument required");if(!s){const t=e(c);a=Te(20,O),o=Array.isArray(t)?t:[t],s=!0,i=setInterval((()=>a=a.filter((e=>{const t=Date.now()-e.created<57333;return t||e.destroy(),t}))),59052.99)}const Z=o.map((()=>5333)),j=[],M=o.map((async(e,r)=>t(await e,await H,await R,(e=>async(t,r,n)=>{const[o,a]=await Ue([H,R]);if(t!==o&&t!==a)return;const{peerId:i,offer:s,answer:d,peer:u}="string"==typeof r?qe(r):r;if(i!==Re&&!B[i])if(!i||s||d){if(s){var h;if((null===(h=k[i])||void 0===h?void 0:h[e])&&Re>i)return;const t=rt(!1,c);let r;t.setHandlers({connect:()=>$(t,i,e),close:()=>N(t,i)});try{r=await D(s)}catch(e){return void _(i,"offer")}if(t.isDead)return;const[o,a]=await Ue([Fe(Ve(T,i)),t.signal(r)]);n(o,Ke({peerId:Re,answer:await z(a)}))}else if(d){let t;try{t=await D(d)}catch(e){return void _(i,"answer")}if(u)u.setHandlers({connect:()=>$(u,i,e),close:()=>N(u,i)}),u.signal(t);else{var y;const r=null===(y=k[i])||void 0===y?void 0:y[e];r&&!r.isDead&&r.signal(t)}}}else{var g;if(null===(g=k[i])||void 0===g?void 0:g[e])return;const[[{peer:t,offer:r}],o]=await Ue([L(1),Fe(Ve(T,i))]);(f=k)[l=i]||(f[l]=[]),k[i][e]=t,setTimeout((()=>((e,t)=>{var r;if(B[e])return;const n=null===(r=k[e])||void 0===r?void 0:r[t];n&&(delete k[e][t],n.destroy())})(i,e)),.9*Z[e]),t.setHandlers({connect:()=>$(t,i,e),close:()=>N(t,i)}),n(o,Ke({peerId:Re,offer:r}))}})(r),L)));Ue([H,R]).then((([e,t])=>{const n=async(o,a)=>{const i=await r(o,e,t);"number"==typeof i&&(Z[a]=i),j[a]=setTimeout((()=>n(o,a)),Z[a])};M.forEach((async(e,t)=>{await e,n(await o[t],t)}))}));let V=$e;return(d=n)[u=I]||(d[u]={}),n[I][E]=((e,t,r)=>{const n={},o={},a={},i={},s={},c={},f={},l={onPeerJoin:$e,onPeerLeave:$e,onPeerStream:$e,onPeerTrack:$e},d=(e,t)=>(e?Array.isArray(e)?e:[e]:Oe(n)).flatMap((e=>{const r=n[e];return r?t(e,r):(console.warn(`${Be}: no peer with id ${e} found`),[])})),u=e=>{n[e]&&(delete n[e],delete i[e],delete s[e],l.onPeerLeave(e),t(e))},E=e=>{if(o[e])return a[e];if(!e)throw Ne("action type argument is required");const t=Ze(e);if(t.byteLength>12)throw Ne(`action type string "${e}" (${t.byteLength}b) exceeds byte limit (12). Hint: choose a shorter name.`);const r=new Uint8Array(12);r.set(t);let i=0;return o[e]={onComplete:$e,onProgress:$e,setOnComplete:t=>o[e]=(0,S.default)((0,A.default)({},o[e]),{onComplete:t}),setOnProgress:t=>o[e]=(0,S.default)((0,A.default)({},o[e]),{onProgress:t}),async send(e,t,o,a){if(o&&"object"!=typeof o)throw Ne("action meta argument must be an object");const s=typeof e;if("undefined"===s)throw Ne("action data cannot be undefined");const c="string"!==s,f=e instanceof Blob,l=f||e instanceof ArrayBuffer||e instanceof ot;if(o&&!l)throw Ne("action meta argument can only be used with binary data");const u=l?new Uint8Array(f?await e.arrayBuffer():e):Ze(c?Ke(e):e),h=o?Ze(Ke(o)):null,y=Math.ceil(u.byteLength/at)+(o?1:0)||1,g=Te(y,((e,t)=>{const n=t===y-1,a=o&&0===t,s=new Uint8Array(15+(a?h.byteLength:n?u.byteLength-at*(y-(o?2:1)):at));return s.set(r),s.set([i],12),s.set([n|a<<1|l<<2|c<<3],13),s.set([Math.round((t+1)/y*it)],14),s.set(o?a?h:u.subarray((t-1)*at,t*at):u.subarray(t*at,(t+1)*at),15),s}));return i=i+1&it,Ue(d(t,(async(e,t)=>{const{channel:r}=t;let i=0;for(;i<y;){const s=g[i];if(r.bufferedAmount>r.bufferedAmountLowThreshold&&await new Promise((e=>{const t=()=>{r.removeEventListener(st,t),e()};r.addEventListener(st,t)})),!n[e])break;t.sendData(s),i++,null==a||a(s[14]/it,e,o)}})))}},(h=a)[y=e]||(h[y]=[o[e].send,o[e].setOnComplete,o[e].setOnProgress])},x=(e,t)=>{const r=new Uint8Array(t),n=je(r.subarray(0,12)).replaceAll("\0",""),[a]=r.subarray(12,13),[s]=r.subarray(13,14),[c]=r.subarray(14,15),f=r.subarray(15),l=!!(1&s),d=!!(2&s),u=!!(4&s),h=!!(8&s);if(!o[n])return void console.warn(`${Be}: received message with unregistered type (${n})`);(g=i)[p=e]||(g[p]={}),(m=i[e])[w=n]||(m[w]={});const y=(v=i[e][n])[b=a]||(v[b]={chunks:[]});if(d?y.meta=qe(je(f)):y.chunks.push(f),o[n].onProgress(c/it,e,y.meta),!l)return;const E=new Uint8Array(y.chunks.reduce(((e,t)=>e+t.byteLength),0));if(y.chunks.reduce(((e,t)=>(E.set(t,e),e+t.byteLength)),0),delete i[e][n][a],u)o[n].onComplete(E,e,y.meta);else{const t=je(E);o[n].onComplete(h?qe(t):t,e)}},P=async()=>{await O(""),await new Promise((e=>setTimeout(e,99))),De(n).forEach((([e,t])=>{t.destroy(),delete n[e]})),r()},[I,k]=E(ct("ping")),[B,T]=E(ct("pong")),[H,R]=E(ct("signal")),[U,C]=E(ct("stream")),[D,z]=E(ct("track")),[O,$]=E(ct("leave"));return(e=>{V=e})(((e,t)=>{var r;n[t]||(n[t]=e,e.setHandlers({data:e=>x(t,e),stream(e){l.onPeerStream(e,t,c[t]),delete c[t]},track(e,r){l.onPeerTrack(e,r,t,f[t]),delete f[t]},signal:e=>H(e,t),close:()=>u(t),error(e){console.error(e),u(t)}}),l.onPeerJoin(t),null===(r=e.drainEarlyData)||void 0===r||r.call(e,(e=>x(t,e))))})),k(((e,t)=>B("",t))),T(((e,t)=>{var r;null===(r=s[t])||void 0===r||r.call(s),delete s[t]})),R(((e,t)=>{var r;return null===(r=n[t])||void 0===r?void 0:r.signal(e)})),C(((e,t)=>c[t]=e)),z(((e,t)=>f[t]=e)),$(((e,t)=>u(t))),Ce&&addEventListener("beforeunload",P),{makeAction:E,leave:P,async ping(e){if(!e)throw Ne("ping() must be called with target peer ID");const t=Date.now();return I("",e),await new Promise((t=>s[e]=t)),Date.now()-t},getPeers:()=>ze(De(n).map((([e,t])=>[e,t.connection]))),addStream:(e,t,r)=>d(t,(async(t,n)=>{r&&await U(r,t),n.addStream(e)})),removeStream:(e,t)=>d(t,((t,r)=>r.removeStream(e))),addTrack:(e,t,r,n)=>d(r,(async(r,o)=>{n&&await D(n,r),o.addTrack(e,t)})),removeTrack:(e,t)=>d(t,((t,r)=>r.removeTrack(e))),replaceTrack:(e,t,r,n)=>d(r,(async(r,o)=>{n&&await D(n,r),o.replaceTrack(e,t)})),onPeerJoin:e=>l.onPeerJoin=e,onPeerLeave:e=>l.onPeerLeave=e,onPeerStream:e=>l.onPeerStream=e,onPeerTrack:e=>l.onPeerTrack=e}})(0,(e=>delete B[e]),(()=>{delete n[I][E],j.forEach(clearTimeout),M.forEach((async e=>(await e)())),clearInterval(i)}))}})({init:e=>((e,t,r)=>(e.relayUrls||((e,t)=>{const r=[...e],n=()=>{const e=1e4*ke(t++);return e-Pe(e)};let o=r.length;for(;o;){const e=Pe(n()*o--);[r[o],r[e]]=[r[e],r[o]]}return r})(t,We(e.appId))).slice(0,e.relayUrls?e.relayUrls.length:e.relayRedundancy||r))(e,St,5).map((e=>{const t=((e,t)=>{const r={},n=()=>{const o=new WebSocket(e);o.onclose=()=>{var t;null!==(t=(E=Je)[x=e])&&void 0!==t||(E[x]=3333),setTimeout(n,Je[e]),Je[e]*=2},o.onmessage=e=>t(e.data),r.socket=o,r.url=o.url,r.ready=new Promise((t=>o.onopen=()=>{t(r),Je[e]=3333})),r.send=e=>{1===o.readyState&&o.send(e)}};return n(),r})(e,(e=>{var r;const[n,o,a,i]=qe(e);if(n===dt)null===(r=gt[o])||void 0===r||r.call(gt,yt[o],a.content);else{const e=`${Be}: relay failure from ${t.url} - `;"NOTICE"===n?console.warn(e+o):"OK"!==n||a||console.warn(e+i)}}));return lt[e]=t,t.ready})),subscribe(e,t,r,n){const o=He(64),a=He(64);return gt[o]=gt[a]=(t,r)=>n(t,r,(async(t,r)=>e.send(await vt(t,r)))),e.send(bt(o,t)),e.send(bt(a,r)),()=>{e.send(Et(o)),e.send(Et(a)),delete gt[o],delete gt[a]}},announce:async(e,t)=>e.send(await vt(t,Ke({peerId:Re})))});At=lt;var At;const St=["eu.purplerelay.com","ftp.halifax.rwth-aachen.de/nostr","multiplexer.huszonegy.world","nostr.cool110.xyz","nostr.data.haus","nostr.grooveix.com","nostr.huszonegy.world","nostr.mom","nostr.sathoarder.com","nostr.vulpem.com","relay.fountain.fm","relay.nostraddress.com","relay.nostromo.social","relay.snort.social","relay.verified-nostr.com","yabu.me/v2"].map((e=>"wss://"+e))}));